# XRP 자동거래 시스템 v4.2.7 🚀

**스마트 잔고 관리 및 캐시 최적화가 적용된 실거래 그리드 트레이딩 봇**

## ✨ 시스템 개요

업비트 API를 활용한 XRP 전용 실거래 자동거래 시스템으로, 그리드 거래 전략과 함께 지능형 잔고 관리 및 API 최적화를 통해 24시간 안정적인 수익을 추구합니다.

### 🎯 핵심 목표
- **안정적 수익 창출**: 그리드 거래를 통한 지속적 수익
- **지능형 위험 관리**: 실제 잔고 기반 자동 투자금액 조정
- **API 최적화**: 캐시 시스템으로 과도한 API 호출 방지
- **실거래 최적화**: 실제 거래 환경에 맞춘 알고리즘

## 🚀 주요 기능

### 📊 **그리드 트레이딩 시스템**
- **자동 그리드 생성**: 24시간/7일/30일 가격 데이터 기반 최적 레벨 설정
- **동적 그리드 조정**: 시장 변동에 따른 실시간 그리드 재설정
- **확인 버퍼**: 0.1% 확인 버퍼로 노이즈 트레이딩 방지
- **유연한 그리드 개수**: 15~30개 그리드로 시장 상황에 따른 조정

### 🛡️ **지능형 위험 관리**
- **스마트 잔고 관리**: 실제 잔고 기반 자동 투자금액 조정
- **스탑로스 시스템**: 설정 비율(기본 3%) 손실 시 자동 중지
- **포트폴리오 추적**: 최고 가치 기준 트레일링 스탑로스
- **주문 크기 제한**: 최소 5,100원 ~ 최대 100,000원
- **잔고 부족 보호**: 잔고가 0원일 때 거래 중단 및 안내

### 🔧 **API 최적화 및 실거래 기능**
- **잔고 조회 캐시**: 5초 캐시로 과도한 API 호출 방지
- **업비트 API 연동**: 실제 거래소 API를 통한 정확한 거래
- **지정가/시장가 선택**: 상황에 따른 최적 주문 유형
- **수수료 반영**: 0.05% 업비트 수수료 포함 수익 계산
- **네트워크 안정성**: API 오류 시 캐시된 값 활용

### 📈 **실시간 모니터링 및 상태 관리**
- **거래 로그**: 모든 거래 내역 상세 기록 (xrp_trade_logs.json)
- **수익률 추적**: 실시간 수익률 계산 및 표시
- **상태 저장**: 프로그램 재시작 시 이전 상태 복구 (xrp_trading_state.json)
- **실시간 현황**: 현재 그리드 상태 및 활성 주문 표시
- **자동 설정 업데이트**: config.json 자동 백업 및 업데이트

## 🔧 설치 및 설정

### 1. 시스템 요구사항
```bash
# Python 3.8 이상 필요
python3 --version

# 필요한 패키지 설치
pip install pyupbit pandas numpy
```

### 2. 업비트 API 설정

#### API 키 발급
1. [업비트](https://upbit.com) 로그인
2. 마이페이지 → Open API 관리
3. API 키 생성 (조회 + 거래 권한 필요)
4. **중요**: 현재 IP 주소 등록 필수

#### IP 주소 등록
```bash
# 현재 IP 확인
curl https://ipinfo.io/ip

# 위 결과를 업비트에 등록
```

### 3. 설정 파일 생성

`config.json` 파일을 다음과 같이 생성:

```json
{
  "upbit_access": "YOUR_UPBIT_ACCESS_KEY",
  "upbit_secret": "YOUR_UPBIT_SECRET_KEY",
  "total_investment": 100000,
  "grid_count": 20,
  "period": "24h",
  "demo_mode": true,
  "auto_trading_mode": true,
  "risk_mode": "stable",
  "tts_enabled": false,
  "fee_rate": 0.0005,
  "confirmation_buffer": 0.001,
  "min_order_amount": 5000,
  "max_order_amount": 100000,
  "use_limit_orders": true,
  "limit_order_buffer": 0.002,
  "stop_loss_enabled": true,
  "stop_loss_percentage": 3.0,
  "max_loss_tolerance": 10.0,
  "initial_xrp_balance": 0,
  "initial_krw_balance": 0,
  "last_balance_update": null
}
```

**주요 설정 추가 사항:**
- `demo_mode`: 데모 거래 모드 (true로 설정하여 안전하게 테스트)
- `auto_trading_mode`: 자동 거래 모드 활성화
- `max_loss_tolerance`: 최대 손실 허용 비율 (10%)
- `initial_*_balance`, `last_balance_update`: 시스템이 자동으로 관리하는 잔고 정보

## 🏃‍♂️ 사용 방법

### 기본 실행
```bash
cd trading
python3 trading.py
```

### 실행 화면
```
🚀 XRP 그리드 트레이딩 봇
==================================================
📋 현재 설정:
   투자 금액: 100,000원
   그리드 개수: 20개
   기간: 24h
   리스크 모드: 안정적
   스탑로스: 3.0% (활성화)

💾 마지막 잔고 업데이트: 2024-01-15T14:30:25
   💰 KRW 잔고: 250,000원
   🪙 XRP 잔고: 105.861524

설정을 수정하시겠습니까? (y/N):
```

### 실시간 거래 모니터링
```
✅ XRP 그리드 트레이딩 시작 완료
명령어:
  'status' - 현재 상태 확인
  'q' - 종료

>>> status
📊 현재 상태:
현재가: 3,945.00원
거래 횟수: 12회
총 수익: 15,750원
활성 주문: 8개

>>> q
🛑 사용자에 의해 중지되었습니다.
```

## ⚙️ 설정 옵션 상세

### 기본 거래 설정
| 설정 | 설명 | 기본값 | 권장 범위 |
|------|------|--------|-----------|
| `total_investment` | 총 투자금액 | 100,000원 | 50,000~1,000,000원 |
| `grid_count` | 그리드 레벨 수 | 20개 | 15~30개 |
| `period` | 분석 기간 | "24h" | "24h", "7d" |
| `confirmation_buffer` | 확인 버퍼 | 0.001 (0.1%) | 0.0005~0.002 |

### 위험 관리 설정
| 설정 | 설명 | 기본값 | 권장 범위 |
|------|------|--------|-----------|
| `stop_loss_enabled` | 스탑로스 활성화 | true | true 권장 |
| `stop_loss_percentage` | 스탑로스 비율 | 3.0% | 2.0~5.0% |
| `min_order_amount` | 최소 주문금액 | 5,000원 | 5,000원 고정 |
| `max_order_amount` | 최대 주문금액 | 100,000원 | 50,000~200,000원 |

### 거래 실행 설정
| 설정 | 설명 | 기본값 | 설명 |
|------|------|--------|-------|
| `use_limit_orders` | 지정가 주문 사용 | true | 슬리피지 방지 |
| `limit_order_buffer` | 지정가 버퍼 | 0.002 (0.2%) | 체결률 향상 |
| `fee_rate` | 거래 수수료율 | 0.0005 (0.05%) | 업비트 기본 수수료 |

## 📊 거래 전략 및 수익 모델

### 그리드 거래 원리
1. **가격 범위 설정**: 최근 24시간 고가/저가 기준
2. **그리드 레벨 생성**: 범위를 균등 분할
3. **양방향 거래**: 각 레벨에서 매수/매도 주문 배치
4. **수익 실현**: 그리드 간 가격 차이로 수익

### 예상 수익률
```
📊 수익률 시뮬레이션 (일 평균)
┌─────────────┬───────────┬─────────────┐
│  변동성     │  예상수익  │   위험도    │
├─────────────┼───────────┼─────────────┤
│  1-2%       │  0.5-1.0%  │    낮음     │
│  2-3%       │  1.0-2.0%  │    보통     │
│  3-5%       │  2.0-3.5%  │    높음     │
│  5%+        │  3.5%+     │   매우높음   │
└─────────────┴───────────┴─────────────┘
```

### 실제 거래 예시
```
2024-01-15 14:30:00 - INFO - ✅ 매수 주문 성공: 2.531646 XRP @ 3,950원
2024-01-15 14:32:15 - INFO - ✅ 매도 주문 성공: 2.531646 XRP @ 4,050원
2024-01-15 14:32:16 - INFO - 🔴 그리드 매도 완료: Level 12, 수익: 2,375원
2024-01-15 14:35:30 - INFO - 📈 현재 수익률: +1.85% (1,850원)
```

## 📈 모니터링 및 로그

### 파일 구조
```
trading/
├── trading.py                # 메인 봇 파일 (5초 캐시 및 스마트 잔고 관리 적용)
├── config.json              # 설정 파일 (자동 업데이트됨)
├── xrp_trading_state.json   # 거래 상태 (자동 생성)
├── xrp_trading.log          # 시스템 로그 (자동 생성)
├── xrp_trade_logs.json      # 거래 내역 로그 (자동 생성)
└── README.md                # 이 파일
```

### 로그 파일 분석
- **시스템 로그**: `xrp_trading.log`
  - 거래 실행 내역 및 시스템 상태
  - 오류 및 경고 메시지
  - API 호출 최적화 정보
  - 잔고 업데이트 및 투자금액 자동 조정 로그

- **거래 내역 로그**: `xrp_trade_logs.json`  
  - 모든 매수/매도 거래의 상세 내역
  - 거래 시간, 가격, 수량, 수익 정보
  - JSON 형태로 구조화된 데이터

- **상태 파일**: `xrp_trading_state.json`
  - 현재 그리드 설정 및 레벨 정보
  - 활성 주문 목록 (매수/매도 대기 상태)
  - 수익 누적 데이터 및 거래 횟수
  - 프로그램 재시작 시 상태 복구용

## 🔍 문제 해결 가이드

### 자주 발생하는 오류

#### 1. API 연결 실패
```
❌ This is not a verified IP
```
**해결방법**:
- 업비트에서 현재 IP 주소 등록
- API 키 재확인

#### 2. 잔고 부족 오류
```
❌ 투자금액이 KRW 잔고를 초과합니다
⚠️ 모든 잔고가 0원입니다. 투자금액을 0원으로 설정합니다.
```
**해결방법**:
- 업비트에 KRW 입금하여 충분한 잔고 확보
- API 키와 IP 주소 설정 재확인
- 시스템이 자동으로 투자금액을 실제 잔고의 90%로 조정

#### 3. 주문 실패 및 최소 금액 문제
```
❌ 매수 주문 실패
⚠️ 주문 금액이 최소값보다 작음
```
**해결방법**:
- 최소 주문 금액(5,000원) 확인
- 투자금액을 충분히 설정 (그리드 개수 × 최소 주문 금액 이상)
- 네트워크 연결 상태 점검
- 업비트 시장 상황 확인

#### 4. 새로운 문제: 과도한 API 호출
```
💰 잔고 조회 완료 - 반복적인 메시지
```
**개선사항**:
- 5초 캐시 시스템으로 API 호출 최적화 완료
- API 제한에 걸리지 않도록 자동 조절

### 성능 최적화

#### 설정 튜닝 가이드
```python
# 보수적 설정 (안전 우선)
{
    "grid_count": 15,
    "stop_loss_percentage": 2.0,
    "confirmation_buffer": 0.002
}

# 공격적 설정 (수익 우선)  
{
    "grid_count": 25,
    "stop_loss_percentage": 5.0,
    "confirmation_buffer": 0.0005
}
```

## ⚠️ 중요 주의사항

### 투자 위험 고지
- **모든 투자는 원금 손실 위험을 포함합니다**
- **암호화폐 시장의 높은 변동성을 고려하세요**
- **시스템 의존적 거래의 위험성을 인지하세요**

### 기술적 주의사항
- **안정적인 인터넷 연결 필수**
- **정전 시 거래 중단 가능성**
- **업비트 API 점검 시 거래 중단**
- **과도한 API 호출로 인한 제한 가능성**

### 보안 권장사항
- **API 키를 타인과 공유 금지**
- **출금 권한은 절대 허용 안함**
- **정기적인 API 키 갱신**
- **IP 주소 변경 시 즉시 업데이트**

## 📞 지원 및 업데이트

### 버전 정보
- **현재 버전**: v4.2.7
- **호환성**: Python 3.8+, 업비트 API v1.0+
- **마지막 업데이트**: 2025-09-03

### v4.2.7 주요 업데이트 내역
- **스마트 잔고 관리**: 실제 잔고 기반 자동 투자금액 조정
- **API 최적화**: 5초 캐시 시스템으로 과도한 API 호출 방지
- **잔고 부족 보호**: 잔고가 0원일 때 안전한 거래 중단
- **최소 주문 금액 검증**: 사전 검증으로 불필요한 주문 시도 방지
- **그리드 최적화**: 투자금액에 따른 적응형 그리드 거래 로직

### 기술 지원
- **문서 업데이트**: 실제 구현 기능 기반 정확한 문서화
- **버그 수정**: 로그 분석 기반 실시간 문제 해결
- **성능 개선**: API 최적화 및 메모리 효율성 향상

---

### 📊 면책 조항
본 소프트웨어는 교육 및 연구 목적으로 제공되며, 투자 손실에 대한 어떠한 보장이나 책임도 지지 않습니다. 사용자는 본인의 판단과 책임 하에 투자 결정을 내려야 합니다.

**🎯 Success with Responsibility - 책임감 있는 투자로 성공하세요!** 🚀